<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather Map Project</title>

    <!--    BOOTSTRAP   -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <!-- BELOW: Mapbox CDN-->
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.css' rel='stylesheet'/>

</head>
<body>

    <h2>Weather</h2>

<!--   Search Bar   -->
       <input type="text" placeholder="Search for Weather" id="searchInput"> <button id="myBtn">Click to Search</button>


<!--  Weather Forecast  -->
    <div id="weatherBody"></div>

<!--  Map  -->
    <div id='map' style='width: auto; height: 200px;'></div>

</body>

<!--BELOW: jQuery CDN-->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"
        integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>

<!--BELOW: Mapbox geocoder-->
<script src="js/mapbox-geocoder-utils.js"></script>

<!--JS keys with gitignore on this file-->
<script src="js/keys.js" ></script>

<script>

    function geoCodeBuilder(searchString) {

        // Mapbox code goes below not weather key

        geocode(searchString, mapKey).then(function (results) {
            // BELOW: Calls back previous marker to move when searched.
            let myOptionsObj = {
                center: results,
                zoom: 13
            };
            map.flyTo(myOptionsObj);
            marker.setLngLat(results)


            $.get(`http://api.openweathermap.org/data/2.5/forecast?lat=${results[1]}&lon=${results[0]}&appid=${weatherKey}&units=imperial`).done(function (data){

                let html = "";

                for (let i = 0; i <= 39; i += 8) {

                    html += `<h4>Date: ${data.list[i].dt_txt}</h4>`

                    html += `<h4>Current Location: ${data.city.name}</h4>`;

                    html += `<h5>High: ${data.list[i].main.temp_max}&deg / Low: ${data.list[i].main.temp_min}&deg</h5>`;

                    html += `<img src="http://openweathermap.org/img/w/${data.list[i].weather[0].icon}.png">`

                    html += `<h5>Description: ${data.list[i].weather[0].description}</h5>`;

                    html += `<h5>Humidity: ${data.list[i].main.humidity} %</h5>`;

                    html += `<h5>Wind: ${data.list[i].wind.speed} MPH</h5>`;

                    html += `<h5>Pressure: ${data.list[i].main.pressure}</h5>`;
                }
                $("#weatherBody").html(html);
            })
        })
    }

    <!--    Create Map   -->
    mapboxgl.accessToken = mapKey;
    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v12',
        center: [-98.4946, 29.4252],
        zoom: 9,
    });

    // Create marker... return draggable true for marker to be movable
    const marker = new mapboxgl.Marker({
        draggable: true
    });
    marker.setLngLat([-98.4946, 29.4252]);
    marker.addTo(map);


    marker.on('dragend', function (e){
        let lonLat = e.target._lngLat;
        reverseGeocode({lat: lonLat.lat, lng:lonLat.lng}, mapKey).then(function(results){
            console.log(results)

            geocode(results, mapKey).then(function (results) {

                $.get(`http://api.openweathermap.org/data/2.5/forecast?lat=${results[1]}&lon=${results[0]}&appid=${weatherKey}&units=imperial`).done(function (data){

                    let html = "";

                    for (let i = 0; i <= 39; i += 8) {

                        html += `<h4>Date: ${data.list[i].dt_txt}</h4>`

                        html += `<h4>Current Location: ${data.city.name}</h4>`;

                        html += `<h5>High: ${data.list[i].main.temp_max}&deg / Low: ${data.list[i].main.temp_min}&deg</h5>`;

                        html += `<img src="http://openweathermap.org/img/w/${data.list[i].weather[0].icon}.png">`

                        html += `<h5>Description: ${data.list[i].weather[0].description}</h5>`;

                        html += `<h5>Humidity: ${data.list[i].main.humidity} %</h5>`;

                        html += `<h5>Wind: ${data.list[i].wind.speed} MPH</h5>`;

                        html += `<h5>Pressure: ${data.list[i].main.pressure}</h5>`;
                    }
                    $("#weatherBody").html(html);
                })
            })
        })
    })

    $("#myBtn").click(function(e){
        e.preventDefault()
        geoCodeBuilder($("#searchInput").val())
    })

//     Calling to display list
geoCodeBuilder("San Antonio, TX");

</script>
</html>